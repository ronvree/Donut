module Main where

import BasicFunctions
import HardwareTypes
import Sprockell
import System
import Simulation

program :: [Instruction]
program = [    Load (ImmValue (500)) (reg1),
    WriteInstr (reg1) (DirAddr 9),
    Load (ImmValue (700)) (reg1),
    WriteInstr (reg1) (DirAddr 10),
    TestAndSet (DirAddr 0),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 1),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 2),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 0),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    ReadInstr (DirAddr 1),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    ReadInstr (DirAddr 2),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    Load (ImmValue (1200)) (reg2),
    WriteInstr (reg2) (DirAddr 11),
    TestAndSet (DirAddr 0),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 1),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 2),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 0),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    ReadInstr (DirAddr 1),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    ReadInstr (DirAddr 2),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    ReadInstr (IndAddr (reg0)),
    Receive (reg0),
    EndProg
    ]

thread1 :: [Instruction]
thread1 = [    Load (ImmValue (0)) (regSprID),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 3),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 4),
    Receive (reg3),
    Branch (reg3) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 9),
    Receive (reg4),
    Load (ImmValue (300)) (reg5),
    Compute Sub (reg4) (reg5) (reg4),
    WriteInstr (reg4) (DirAddr 9),
    ReadInstr (DirAddr 10),
    Receive (reg4),
    Load (ImmValue (300)) (reg5),
    Compute Add (reg4) (reg5) (reg4),
    WriteInstr (reg4) (DirAddr 10),
    WriteInstr (reg0) (DirAddr 4),
    ReadInstr (DirAddr 4),
    Receive (reg3),
    Branch (reg3) (Rel (-2)),
    WriteInstr (reg0) (DirAddr 3),
    ReadInstr (DirAddr 3),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    TestAndSet (DirAddr 3),
    Receive (reg4),
    Branch (reg4) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 4),
    Receive (reg5),
    Branch (reg5) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 10),
    Receive (reg6),
    Load (ImmValue (100)) (reg7),
    Compute Sub (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 10),
    ReadInstr (DirAddr 9),
    Receive (reg6),
    Load (ImmValue (100)) (reg7),
    Compute Add (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 9),
    WriteInstr (reg0) (DirAddr 4),
    ReadInstr (DirAddr 4),
    Receive (reg5),
    Branch (reg5) (Rel (-2)),
    WriteInstr (reg0) (DirAddr 3),
    ReadInstr (DirAddr 3),
    Receive (reg4),
    Branch (reg4) (Rel (-2)),
    WriteInstr (reg0) (IndAddr (regSprID)),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    Load (ImmValue (0)) (regSprID),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 5),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg3),
    Load (ImmValue (300)) (reg4),
    Compute Sub (reg3) (reg4) (reg3),
    WriteInstr (reg3) (DirAddr 11),
    ReadInstr (DirAddr 11),
    Receive (reg3),
    Load (ImmValue (100)) (reg4),
    Compute Sub (reg3) (reg4) (reg3),
    WriteInstr (reg3) (DirAddr 11),
    ReadInstr (DirAddr 11),
    Receive (reg3),
    Load (ImmValue (200)) (reg4),
    Compute Sub (reg3) (reg4) (reg3),
    WriteInstr (reg3) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg3),
    Branch (reg3) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg4),
    Load (ImmValue (800)) (reg5),
    Compute Add (reg4) (reg5) (reg4),
    WriteInstr (reg4) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg3),
    Branch (reg3) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg4),
    Branch (reg4) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg5),
    Load (ImmValue (200)) (reg6),
    Compute Sub (reg5) (reg6) (reg5),
    WriteInstr (reg5) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg4),
    Branch (reg4) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg5),
    Branch (reg5) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg6),
    Load (ImmValue (100)) (reg7),
    Compute Add (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg5),
    Branch (reg5) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg6),
    Branch (reg6) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg7),
    Load (ImmValue (100)) (reg8),
    Compute Add (reg7) (reg8) (reg7),
    WriteInstr (reg7) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg6),
    Branch (reg6) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg7),
    Branch (reg7) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg8),
    Load (ImmValue (300)) (reg9),
    Compute Sub (reg8) (reg9) (reg8),
    WriteInstr (reg8) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg7),
    Branch (reg7) (Rel (-2)),
    WriteInstr (reg0) (IndAddr (regSprID)),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    EndProg
    ]

thread2 :: [Instruction]
thread2 = [    Load (ImmValue (1)) (regSprID),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 3),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 4),
    Receive (reg3),
    Branch (reg3) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 10),
    Receive (reg4),
    Load (ImmValue (800)) (reg5),
    Compute Sub (reg4) (reg5) (reg4),
    WriteInstr (reg4) (DirAddr 10),
    ReadInstr (DirAddr 9),
    Receive (reg4),
    Load (ImmValue (800)) (reg5),
    Compute Add (reg4) (reg5) (reg4),
    WriteInstr (reg4) (DirAddr 9),
    WriteInstr (reg0) (DirAddr 4),
    ReadInstr (DirAddr 4),
    Receive (reg3),
    Branch (reg3) (Rel (-2)),
    WriteInstr (reg0) (DirAddr 3),
    ReadInstr (DirAddr 3),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    TestAndSet (DirAddr 3),
    Receive (reg4),
    Branch (reg4) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 4),
    Receive (reg5),
    Branch (reg5) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 9),
    Receive (reg6),
    Load (ImmValue (300)) (reg7),
    Compute Sub (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 9),
    ReadInstr (DirAddr 10),
    Receive (reg6),
    Load (ImmValue (300)) (reg7),
    Compute Add (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 10),
    ReadInstr (DirAddr 9),
    Receive (reg6),
    Load (ImmValue (200)) (reg7),
    Compute Add (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 9),
    ReadInstr (DirAddr 10),
    Receive (reg6),
    Load (ImmValue (200)) (reg7),
    Compute Sub (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 10),
    WriteInstr (reg0) (DirAddr 4),
    ReadInstr (DirAddr 4),
    Receive (reg5),
    Branch (reg5) (Rel (-2)),
    WriteInstr (reg0) (DirAddr 3),
    ReadInstr (DirAddr 3),
    Receive (reg4),
    Branch (reg4) (Rel (-2)),
    WriteInstr (reg0) (IndAddr (regSprID)),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    Load (ImmValue (1)) (regSprID),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 5),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg3),
    Load (ImmValue (300)) (reg4),
    Compute Add (reg3) (reg4) (reg3),
    WriteInstr (reg3) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg3),
    Branch (reg3) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg4),
    Load (ImmValue (200)) (reg5),
    Compute Add (reg4) (reg5) (reg4),
    WriteInstr (reg4) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg3),
    Branch (reg3) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg4),
    Branch (reg4) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg5),
    Load (ImmValue (200)) (reg6),
    Compute Add (reg5) (reg6) (reg5),
    WriteInstr (reg5) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg4),
    Branch (reg4) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg5),
    Branch (reg5) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg6),
    Load (ImmValue (300)) (reg7),
    Compute Sub (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg5),
    Branch (reg5) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg6),
    Branch (reg6) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg7),
    Load (ImmValue (300)) (reg8),
    Compute Add (reg7) (reg8) (reg7),
    WriteInstr (reg7) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg6),
    Branch (reg6) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg7),
    Branch (reg7) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg8),
    Load (ImmValue (600)) (reg9),
    Compute Sub (reg8) (reg9) (reg8),
    WriteInstr (reg8) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg7),
    Branch (reg7) (Rel (-2)),
    WriteInstr (reg0) (IndAddr (regSprID)),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    EndProg
    ]

thread3 :: [Instruction]
thread3 = [    Load (ImmValue (2)) (regSprID),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    WriteInstr (reg0) (IndAddr (regSprID)),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    Load (ImmValue (2)) (regSprID),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (2)),
    Jump (Rel (-3)),
    TestAndSet (DirAddr 5),
    Receive (reg2),
    Branch (reg2) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg3),
    Load (ImmValue (300)) (reg4),
    Compute Add (reg3) (reg4) (reg3),
    WriteInstr (reg3) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg2),
    Branch (reg2) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg3),
    Branch (reg3) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg4),
    Load (ImmValue (400)) (reg5),
    Compute Add (reg4) (reg5) (reg4),
    WriteInstr (reg4) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg3),
    Branch (reg3) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg4),
    Branch (reg4) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg5),
    Load (ImmValue (100)) (reg6),
    Compute Sub (reg5) (reg6) (reg5),
    WriteInstr (reg5) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg4),
    Branch (reg4) (Rel (-2)),
    TestAndSet (DirAddr 5),
    Receive (reg5),
    Branch (reg5) (Rel (2)),
    Jump (Rel (-3)),
    ReadInstr (DirAddr 11),
    Receive (reg6),
    Load (ImmValue (100)) (reg7),
    Compute Sub (reg6) (reg7) (reg6),
    WriteInstr (reg6) (DirAddr 11),
    WriteInstr (reg0) (DirAddr 5),
    ReadInstr (DirAddr 5),
    Receive (reg5),
    Branch (reg5) (Rel (-2)),
    WriteInstr (reg0) (IndAddr (regSprID)),
    ReadInstr (IndAddr (regSprID)),
    Receive (reg1),
    Branch (reg1) (Rel (-2)),
    EndProg
    ]


main = sysTest [program,thread1,thread2,thread3]